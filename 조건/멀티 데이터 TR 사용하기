import time

import pandas as pd
from pykiwoom.kiwoom import *

#로그인
Kiwoom = Kiwoom()
Kiwoom.CommConnect(block = True)

dfs = []
df = Kiwoom.block_request("opt10001", 종목코드 = "005930", 기준일자 = '20200424', 수정주가구분 = 1, output = '주식일봉차트조회', next = 0)
print(df.head())

'''
데이터의 행이 많은 경우 키움증권 서버는 이를 한 번에 보내주지 않는다.
데이터 양이 많은 경우 끊어서 데이터를 보내주게 되는데 
키움에서는 이를 연속조회라고 표현한다.

멀티데이터의 행이 많게되면
키움은 한 번에 정해진 수의 행만 보내주게 되는데
남은 데이터를 받으려면 서버로부터 데이터가 남아있는지를 확인한 후
다시 TR요청을 해야한다. 이러한 요청방식을 연속조회라고 부른다.
'''

dfs.append(df)

while Kiwoom.tr_remained:
    df = Kiwoom.block_request("opt10001", 종목코드 = "005930", 기준일자 = '20200424', 수정주가구분 = 1, output = '주식일봉차트조회', next = 2)
    dfs.append(df)
    time.sleep(1)

df = pd.concat(dfs)
df.to_excel("005930.xlsx")
print("dataFrame: ", df)